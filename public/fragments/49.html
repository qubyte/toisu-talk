<div>
  <h2>toisu-middleware-runner</h2>
  <pre class="prettyprint lang-js" style="font-size: 1.5em">'use strict';

function runner(req, res, middlewares) {
  var context = this;

  function wrapper(index) {
    var middleware = middlewares && middlewares[index];

    if (!middleware || res.headersSent || !res.writable) {
      return Promise.resolve();
    }

    return Promise.resolve(middleware.call(context, req, res))
      .then(function () {
        return wrapper(index + 1);
      });
  }

  return wrapper(0);
}

module.exports = runner;</pre>
</div>
